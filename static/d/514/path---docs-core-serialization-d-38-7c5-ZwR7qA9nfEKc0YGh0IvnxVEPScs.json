{"pageContext":{"html":"<h1 id=\"the-serialization-process\"><a href=\"#the-serialization-process\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Serialization Process</h1>\n<h2 id=\"overall-process\"><a href=\"#overall-process\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overall Process</h2>\n<p>API Platform embraces and extends the Symfony Serializer Component to transform PHP entities in (hypermedia) API responses.</p>\n<p>The main serialization process has two stages:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f5bf57af8c8a3275d8ba1c9ced6e890d/9e5e8/SerializerWorkflow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 859px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.40162980209546%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVQoz11Sy27jMAz0/39WznWRQ+5tsw6cNJZcvWVL8izJjdN2CQiU+BiSI3bbtoElpQTrLEIMcN7DOSfvGCPe3t9wOBzwcf4QvyWf8w6e4nzwEsf5LN0OWEpBXjI8ORfSrRXUWkhXGGMI7I8ANbLVsqKsK3LOSCFKHucLIP4TO92w5AXDqHG5aty1xaQd7jN1nMhO+qwsdMgSn7/cr/yuLAsqVePTWoOflVR3PsHYICfEjNnRqNwN+dJaUGrDRvFRGbRS0cjWyNbpywA1DGDttYbTihxVqgXiJ+ck3B2PR+KTQK15jsd0+esEf1Pw44Rs3PfIO5eOOmTuWBbqfqXKTPyk7sLZ+phEckin2f7KF8DtBwcMuHcYVwsVRrhFw6cvArYYPwd8TtcH4Ib8ANxBn7/MVSsBeTNjZV7pzr/NK2G9wWU843a7yo8vDz9369VMfNZn193PPeTRYoqya7x/vGun00n46/seL/0L+tde4jjm34ny3vfwL9h4uJsmF5O1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Serializer workflow\"\n        title=\"\"\n        src=\"/static/f5bf57af8c8a3275d8ba1c9ced6e890d/9e5e8/SerializerWorkflow.png\"\n        srcset=\"/static/f5bf57af8c8a3275d8ba1c9ced6e890d/ef67f/SerializerWorkflow.png 280w,\n/static/f5bf57af8c8a3275d8ba1c9ced6e890d/90e06/SerializerWorkflow.png 560w,\n/static/f5bf57af8c8a3275d8ba1c9ced6e890d/9e5e8/SerializerWorkflow.png 859w\"\n        sizes=\"(max-width: 859px) 100vw, 859px\"\n      />\n  </span>\n  </a></p>\n<blockquote>\n<p>As you can see in the picture above, an array is used as a man-in-the-middle. This way, Encoders will only deal with turning specific formats into arrays and vice versa. The same way, Normalizers will deal with turning specific objects into arrays and vice versa.\n-- <a href=\"https://symfony.com/doc/current/components/serializer.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">The Symfony documentation</a></p>\n</blockquote>\n<p>Unlike Symfony itself, API Platform leverages custom normalizers, its router and the <a href=\"/docs/core/data-providers/\">data provider</a> system to perform an advanced transformation. Metadata are added to the generated document including links, type information, pagination data or available filters.</p>\n<p>The API Platform Serializer is extendable. You can register custom normalizers and encoders in order to support other formats. You can also decorate existing normalizers to customize their behaviors.</p>\n<h2 id=\"available-serializers\"><a href=\"#available-serializers\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Available Serializers</h2>\n<ul>\n<li><a href=\"https://json-ld.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JSON-LD</a> serializer\n<code class=\"language-text\">api_platform.jsonld.normalizer.item</code></li>\n</ul>\n<p>JSON-LD, or JavaScript Object Notation for Linked Data, is a method of encoding Linked Data using JSON. It is a World Wide Web Consortium Recommendation.</p>\n<ul>\n<li>\n<p><a href=\"https://en.wikipedia.org/wiki/Hypertext_Application_Language\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">HAL</a> serializer\n<code class=\"language-text\">api_platform.hal.normalizer.item</code></p>\n</li>\n<li>\n<p>JSON, XML, CSV, YAML serializer (using the Symfony serializer)\n<code class=\"language-text\">api_platform.serializer.normalizer.item</code></p>\n</li>\n</ul>\n<h2 id=\"the-serialization-context-groups-and-relations\"><a href=\"#the-serialization-context-groups-and-relations\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Serialization Context, Groups and Relations</h2>\n<p>API Platform allows you to specify the <code class=\"language-text\">$context</code> variable used by the Symfony Serializer. This variable is an associative array that has a handy <code class=\"language-text\">groups</code> key allowing you to choose which attributes of the resource are exposed during the normalization (read) and denormalization (write) processes.\nIt relies on the <a href=\"https://symfony.com/doc/current/components/serializer.html#attributes-groups\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">serialization (and deserialization) groups</a>\nfeature of the Symfony Serializer component.</p>\n<p>In addition to groups, you can use any option supported by the Symfony Serializer. For example, you can use <a href=\"https://symfony.com/doc/current/components/serializer.html#handling-serialization-depth\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">enable_max_depth</code></a>\nto limit the serialization depth.</p>\n<h3 id=\"configuration\"><a href=\"#configuration\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuration</h3>\n<p>Just like other Symfony and API Platform components, the Serializer component can be configured using annotations, XML or YAML.\nSince annotations are easy to understand, we will use them in the following examples.</p>\n<p>Note: if you aren't using the official distribution of API Platform, you will need to enable annotation support in the serializer\nconfiguration:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/packages/api_platform.yaml</span>\n<span class=\"token key atrule\">framework</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">serializer</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token key atrule\">enable_annotations</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true </span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you use <a href=\"https://github.com/symfony/flex\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Symfony Flex</a>, just execute <code class=\"language-text\">composer req doctrine/annotations</code> and you are\nall set!</p>\n<p>If you want to use YAML or XML, please add the mapping path in the serializer configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/packages/api_platform.yaml</span>\n<span class=\"token key atrule\">framework</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">serializer</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">mapping</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'%kernel.project_dir%/config/serialization'</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"using-serialization-groups\"><a href=\"#using-serialization-groups\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Serialization Groups</h2>\n<p>It is simple to specify what groups to use in the API system:</p>\n<ol>\n<li>Add the <code class=\"language-text\">normalizationContext</code> and <code class=\"language-text\">denormalizationContext</code> annotation properties to the <code class=\"language-text\">@ApiResource</code> annotation, and specify which groups to use. Here you see that we add <code class=\"language-text\">read</code> and <code class=\"language-text\">write</code>, respectively. You can use any group names you wish.</li>\n<li>Apply the <code class=\"language-text\">@Groups</code> annotation to properties in the object.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>Groups</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(\n *     normalizationContext={\"groups\"={\"read\"}},\n *     denormalizationContext={\"groups\"={\"write\"}}\n * )\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @Groups({\"read\", \"write\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @Groups(\"write\")\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$author</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Alternatively, you can use the more verbose syntax:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(attributes={\n *     \"normalization_context\"={\"groups\"={\"read\"}},\n *     \"denormalization_context\"={\"groups\"={\"write\"}}\n * })\n */</span></span></code></pre></div>\n<p>You can also use the YAML configuration format:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/api_platform/resources.yaml</span>\n<span class=\"token key atrule\">App\\Entity\\Book</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">attributes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">normalization_context</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'read'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">denormalization_context</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'write'</span><span class=\"token punctuation\">]</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/serialization/Book.yaml</span>\n<span class=\"token key atrule\">App\\Entity\\Book</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">attributes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'read'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'write'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">author</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'write'</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>In the previous example, the <code class=\"language-text\">name</code> property will be visible when reading (<code class=\"language-text\">GET</code>) the object, and it will also be available\nto write (<code class=\"language-text\">PUT/POST</code>). The <code class=\"language-text\">author</code> property will be write-only; it will not be visible when serialized responses are\nreturned by the API.</p>\n<p>Internally, API Platform passes the value of the <code class=\"language-text\">normalization_context</code> as the 3rd argument of <a href=\"https://api.symfony.com/master/Symfony/Component/Serializer/SerializerInterface.html#method_serialize\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the <code class=\"language-text\">Serializer::serialize()</code> method</a> during the normalization\nprocess. <code class=\"language-text\">denormalization_context</code> is passed as the 4th argument of <a href=\"https://api.symfony.com/master/Symfony/Component/Serializer/SerializerInterface.html#method_deserialize\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the <code class=\"language-text\">Serializer::deserialize()</code> method</a> during denormalization (writing).</p>\n<p>To configure the serialization groups of classes's properties, you must use directly <a href=\"https://symfony.com/doc/current/components/serializer.html#attributes-groups\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the Symfony Serializer's configuration files or annotations</a>.</p>\n<p>In addition to the <code class=\"language-text\">groups</code> key, you can configure any Symfony Serializer option through the <code class=\"language-text\">$context</code> parameter\n(e.g. the <code class=\"language-text\">enable_max_depth</code>key when using <a href=\"https://symfony.com/doc/current/components/serializer.html#handling-serialization-depth\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the <code class=\"language-text\">@MaxDepth</code> annotation</a>).</p>\n<p>Any serialization and deserialization group that you specify will also be leveraged by the built-in actions and the Hydra\ndocumentation generator.</p>\n<h2 id=\"using-serialization-groups-per-operation\"><a href=\"#using-serialization-groups-per-operation\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Serialization Groups per Operation</h2>\n<p>It is possible to specify normalization and denormalization contexts (as well as any other attribute) on a per-operation\nbasis. API Platform will always use the most specific definition. For instance, if normalization groups are set both\nat the resource level and at the operation level, the configuration set at the operation level will be used and the resource\nlevel ignored.</p>\n<p>In the following example we use different serialization groups for the <code class=\"language-text\">GET</code> and <code class=\"language-text\">PUT</code> operations:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>Groups</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(\n *     normalizationContext={\"groups\"={\"get\"}},\n *     itemOperations={\n *         \"get\",\n *         \"put\"={\n *             \"normalization_context\"={\"groups\"={\"put\"}}\n *         }\n *     }\n * )\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @Groups({\"get\", \"put\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @Groups(\"get\")\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$author</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>The <code class=\"language-text\">name</code> and <code class=\"language-text\">author</code> properties will be included in the document generated during a <code class=\"language-text\">GET</code> operation because the configuration\ndefined at the resource level is inherited. However the document generated when a <code class=\"language-text\">PUT</code> request will be received will only\ninclude the <code class=\"language-text\">name</code> property because of the specific configuration for this operation.</p>\n<p>Refer to the <a href=\"/docs/core/operations/\">operations</a> documentation to learn more.</p>\n<h3 id=\"embedding-relations\"><a href=\"#embedding-relations\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Embedding Relations</h3>\n<p>By default, the serializer provided with API Platform represents relations between objects using <a href=\"https://en.wikipedia.org/wiki/Internationalized_Resource_Identifier\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dereferenceable IRIs</a>.\nThey allow you to retrieve details for related objects by issuing extra HTTP requests.</p>\n<p>In the following JSON document, the relation from a book to an author is represented by an URI:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"@context\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/contexts/Book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/books/62\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My awesome book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/people/59\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>However, for performance reasons, it is sometimes preferable to avoid forcing the client to issue extra HTTP requests.\nIt is possible to embed related objects (in their entirety, or only some of their properties) directly in the parent\nresponse through the use of serialization groups. By using the following serialization groups annotations (<code class=\"language-text\">@Groups</code>),\na JSON representation of the author is embedded in the book response:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>Groups</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(normalizationContext={\"groups\"={\"book\"}})\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @Groups({\"book\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @Groups({\"book\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$author</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Person.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>Groups</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * ...\n     * @Groups(\"book\")\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>The generated JSON using previous settings is below:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"@context\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/contexts/Book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/books/62\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My awesome book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/people/59\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Person\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"KÃ©vin Dunglas\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In order to optimize such embedded relations, the default Doctrine data provider will automatically join entities on relations\nmarked as <a href=\"https://www.doctrine-project.org/projects/doctrine-orm/en/current/reference/annotations-reference.html#manytoone\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">EAGER</code></a>.\nThis avoids the need for extra queries to be executed when serializing the related objects.</p>\n<p>Instead of embedding relations in the main HTTP response, you may want <a href=\"/docs/core/push-relations/\">to \"push\" them to the client using HTTP/2 server push</a>.</p>\n<h3 id=\"denormalization\"><a href=\"#denormalization\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Denormalization</h3>\n<p>It is also possible to embed a relation in <code class=\"language-text\">PUT</code> and <code class=\"language-text\">POST</code> requests. To enable that feature, set the serialization groups\nthe same way as normalization. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(denormalizationContext={\"groups\"={\"book\"}})\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>The following rules apply when denormalizing embedded relations:</p>\n<ul>\n<li>If an <code class=\"language-text\">@id</code> key is present in the embedded resource, then the object corresponding to the given URI will be retrieved through\nthe data provider. Any changes in the embedded relation will also be applied to that object.</li>\n<li>If no <code class=\"language-text\">@id</code> key exists, a new object will be created containing data provided in the embedded JSON document.</li>\n</ul>\n<p>You can specify as many embedded relation levels as you want.</p>\n<h2 id=\"changing-the-serialization-context-dynamically\"><a href=\"#changing-the-serialization-context-dynamically\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changing the Serialization Context Dynamically</h2>\n<p>Let's imagine a resource where most fields can be managed by any user, but some can be managed only by admin users:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>Groups</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(\n *     normalizationContext={\"groups\"={\"book:output\"}},\n *     denormalizationContext={\"groups\"={\"book:input\"}}\n * )\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">/**\n     * This field can be managed only by an admin\n     *\n     * @var bool\n     *\n     * @Groups({\"book:output\", \"admin:input\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$active</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * This field can be managed by any user\n     *\n     * @var string\n     *\n     * @Groups({\"book:output\", \"book:input\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>All entry points are the same for all users, so we should find a way to detect if the authenticated user is an admin, and if so\ndynamically add the <code class=\"language-text\">admin:input</code> value to deserialization groups in the <code class=\"language-text\">$context</code> array.</p>\n<p>API Platform implements a <code class=\"language-text\">ContextBuilder</code>, which prepares the context for serialization &#x26; deserialization. Let's\n<a href=\"http://symfony.com/doc/current/service_container/service_decoration.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">decorate this service</a> to override the\n<code class=\"language-text\">createFromRequest</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/services.yaml</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># ...</span>\n    <span class=\"token key atrule\">'App\\Serializer\\BookContextBuilder'</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">decorates</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'api_platform.serializer.context_builder'</span>\n        <span class=\"token key atrule\">arguments</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">'@App\\Serializer\\BookContextBuilder.inner'</span> <span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">autoconfigure</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Serializer/BookContextBuilder.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Serializer</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>SerializerContextBuilderInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>HttpFoundation<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Security<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Authorization<span class=\"token punctuation\">\\</span>AuthorizationCheckerInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity<span class=\"token punctuation\">\\</span>Book</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BookContextBuilder</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SerializerContextBuilderInterface</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$decorated</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$authorizationChecker</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span>SerializerContextBuilderInterface <span class=\"token variable\">$decorated</span><span class=\"token punctuation\">,</span> AuthorizationCheckerInterface <span class=\"token variable\">$authorizationChecker</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$decorated</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">authorizationChecker</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$authorizationChecker</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createFromRequest</span><span class=\"token punctuation\">(</span>Request <span class=\"token variable\">$request</span><span class=\"token punctuation\">,</span> bool <span class=\"token variable\">$normalization</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token keyword\">array</span> <span class=\"token variable\">$extractedAttributes</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">array</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$context</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">createFromRequest</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$normalization</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$extractedAttributes</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$resourceClass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$context</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'resource_class'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$resourceClass</span> <span class=\"token operator\">===</span> Book<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">class</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$context</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'groups'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">authorizationChecker</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">isGranted</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'ROLE_ADMIN'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token boolean\">false</span> <span class=\"token operator\">===</span> <span class=\"token variable\">$normalization</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$context</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'groups'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'admin:input'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$context</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>If the user has the <code class=\"language-text\">ROLE_ADMIN</code> permission and the subject is an instance of Book, <code class=\"language-text\">admin_input</code> group will be dynamically added to the\ndenormalization context. The <code class=\"language-text\">$normalization</code> variable lets you check whether the context is for normalization (if <code class=\"language-text\">TRUE</code>) or denormalization\n(<code class=\"language-text\">FALSE</code>).</p>\n<h2 id=\"changing-the-serialization-context-on-a-per-item-basis\"><a href=\"#changing-the-serialization-context-on-a-per-item-basis\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changing the Serialization Context on a Per-item Basis</h2>\n<p>The example above demonstrates how you can modify the normalization/denormalization context based on the current user\npermissions for all books. Sometimes, however, the permissions vary depending on what book is being processed.</p>\n<p>Think of ACL's: User \"A\" may retrieve Book \"A\" but not Book \"B\". In this case, we need to leverage the power of the\nSymfony Serializer and register our own normalizer that adds the group on every single item (note: priority <code class=\"language-text\">64</code> is\nan example; it is always important to make sure your normalizer gets loaded first, so set the priority to whatever value\nis appropriate for your application; higher values are loaded earlier):</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/services.yaml</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">'App\\Serializer\\BookAttributeNormalizer'</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">arguments</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">'@security.token_storage'</span> <span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">{</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'serializer.normalizer'</span><span class=\"token punctuation\">,</span> <span class=\"token key atrule\">priority</span><span class=\"token punctuation\">:</span> <span class=\"token number\">64 </span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>The Normalizer class is a bit harder to understand, because it must ensure that it is only called once and that there is no recursion.\nTo accomplish this, it needs to be aware of the parent Normalizer instance itself.</p>\n<p>Here is an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Serializer/BookAttributeNormalizer.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Serializer</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Security<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Authentication<span class=\"token punctuation\">\\</span>Token<span class=\"token punctuation\">\\</span>Storage<span class=\"token punctuation\">\\</span>TokenStorageInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Normalizer<span class=\"token punctuation\">\\</span>ContextAwareNormalizerInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Normalizer<span class=\"token punctuation\">\\</span>NormalizerAwareInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Normalizer<span class=\"token punctuation\">\\</span>NormalizerAwareTrait</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Normalizer<span class=\"token punctuation\">\\</span>NormalizerInterface</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BookAttributeNormalizer</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ContextAwareNormalizerInterface</span><span class=\"token punctuation\">,</span> NormalizerAwareInterface\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">use</span> <span class=\"token package\">NormalizerAwareTrait</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">ALREADY_CALLED</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'BOOK_ATTRIBUTE_NORMALIZER_ALREADY_CALLED'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$tokenStorage</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span>TokenStorageInterface <span class=\"token variable\">$tokenStorage</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">tokenStorage</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$tokenStorage</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$object</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span> <span class=\"token variable\">$context</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">userHasPermissionsForBook</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$context</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'groups'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'can_retrieve_book'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token variable\">$context</span><span class=\"token punctuation\">[</span>self<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">ALREADY_CALLED</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">normalizer</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$object</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$context</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">supportsNormalization</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span> <span class=\"token variable\">$context</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Make sure we're not called twice</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$context</span><span class=\"token punctuation\">[</span>self<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">ALREADY_CALLED</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$data</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Book</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">function</span> <span class=\"token function\">userHasPermissionsForBook</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> bool\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get permissions from user in $this->tokenStorage</span>\n        <span class=\"token comment\">// for the current $object (book) and</span>\n        <span class=\"token comment\">// return true or false</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>This will add the serialization group <code class=\"language-text\">can_retrieve_book</code> only if the currently logged-in user has access to the given book\ninstance.</p>\n<p>Note: In this example, we use the <code class=\"language-text\">TokenStorageInterface</code> to verify access to the book instance. However, Symfony\nprovides many useful other services that might be better suited to your use case. For example, the <a href=\"https://symfony.com/doc/current/components/security/authorization.html#authorization-checker\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">AuthorizationChecker</code></a>.</p>\n<h2 id=\"name-conversion\"><a href=\"#name-conversion\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Name Conversion</h2>\n<p>The Serializer Component provides a handy way to map PHP field names to serialized names. See the related <a href=\"http://symfony.com/doc/master/components/serializer.html#converting-property-names-when-serializing-and-deserializing\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Symfony documentation</a>.</p>\n<p>To use this feature, declare a new name converter service. For example, you can convert <code class=\"language-text\">CamelCase</code> to\n<code class=\"language-text\">snake_case</code> with the following configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/services.yaml</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">'Symfony\\Component\\Serializer\\NameConverter\\CamelCaseToSnakeCaseNameConverter'</span><span class=\"token punctuation\">:</span> <span class=\"token null important\">~</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/packages/api_platform.yaml</span>\n<span class=\"token key atrule\">api_platform</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name_converter</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Symfony\\Component\\Serializer\\NameConverter\\CamelCaseToSnakeCaseNameConverter'</span></code></pre></div>\n<p>If symfony's <code class=\"language-text\">MetadataAwareNameConverter</code> is available it'll be used by default. If you specify one in ApiPlatform configuration, it'll be used. Note that you can use decoration to benefit from this name converter in your own implementation.</p>\n<h2 id=\"decorating-a-serializer-and-adding-extra-data\"><a href=\"#decorating-a-serializer-and-adding-extra-data\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Decorating a Serializer and Adding Extra Data</h2>\n<p>In the following example, we will see how we add extra informations to the serialized output. Here is how we add the\ndate on each request in <code class=\"language-text\">GET</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/services.yaml</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">'App\\Serializer\\ApiNormalizer'</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">decorates</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'api_platform.jsonld.normalizer.item'</span>\n        <span class=\"token key atrule\">arguments</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">'@App\\Serializer\\ApiNormalizer.inner'</span> <span class=\"token punctuation\">]</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Serializer/ApiNormalizer</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Serializer</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Normalizer<span class=\"token punctuation\">\\</span>DenormalizerInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>Normalizer<span class=\"token punctuation\">\\</span>NormalizerInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>SerializerAwareInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Serializer<span class=\"token punctuation\">\\</span>SerializerInterface</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApiNormalizer</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NormalizerInterface</span><span class=\"token punctuation\">,</span> DenormalizerInterface<span class=\"token punctuation\">,</span> SerializerAwareInterface\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$decorated</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span>NormalizerInterface <span class=\"token variable\">$decorated</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$decorated</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">DenormalizerInterface</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token punctuation\">\\</span>InvalidArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'The decorated normalizer must implement the %s.'</span><span class=\"token punctuation\">,</span> DenormalizerInterface<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$decorated</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">supportsNormalization</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">supportsNormalization</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$object</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span> <span class=\"token variable\">$context</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$object</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$context</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$data</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'date'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span>\\<span class=\"token package\">DateTime</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">RFC3339</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$data</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">supportsDenormalization</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$type</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">supportsDenormalization</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$type</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">denormalize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$class</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span> <span class=\"token variable\">$context</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">denormalize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$class</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$format</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$context</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">setSerializer</span><span class=\"token punctuation\">(</span>SerializerInterface <span class=\"token variable\">$serializer</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">SerializerAwareInterface</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">decorated</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">setSerializer</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$serializer</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<h2 id=\"entity-identifier-case\"><a href=\"#entity-identifier-case\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entity Identifier Case</h2>\n<p>API Platform is able to guess the entity identifier using Doctrine metadata (<a href=\"http://doctrine-orm.readthedocs.org/en/latest/reference/basic-mapping.html#identifiers-primary-keys\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ORM</a>, <a href=\"https://www.doctrine-project.org/projects/doctrine-mongodb-odm/en/latest/reference/basic-mapping.html#identifiers\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MongoDB ODM</a>).\nFor ORM, it also supports composite identifiers.</p>\n<p>If you are not using the Doctrine ORM or MongoDB ODM Provider, you must explicitly mark the identifier using the <code class=\"language-text\">identifier</code> attribute of\nthe <code class=\"language-text\">ApiPlatform\\Core\\Annotation\\ApiProperty</code> annotation. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * @ApiResource()\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">/**\n     * @ApiProperty(identifier=true)\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * This field can be managed only by an admin\n     *\n     * @var bool\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$active</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * This field can be managed by any user\n     *\n     * @var string\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can also use the YAML configuration format:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/api_platform/resources.yaml</span>\n<span class=\"token key atrule\">App\\Entity\\Book</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">identifier</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>In some cases, you will want to set the identifier of a resource from the client (e.g. a client-side generated UUID, or a slug).\nIn such cases, you must make the identifier property a writable class property. Specifically, to use client-generated IDs, you\nmust do the following:</p>\n<ol>\n<li>create a setter for the identifier of the entity (e.g. <code class=\"language-text\">public function setId(string $id)</code>) or make it a <code class=\"language-text\">public</code> property ,</li>\n<li>add the denormalization group to the property (only if you use a specific denormalization group), and,</li>\n<li>if you use Doctrine ORM, be sure to <strong>not</strong> mark this property with <a href=\"http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/basic-mapping.html#identifier-generation-strategies\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the <code class=\"language-text\">@GeneratedValue</code> annotation</a>\nor use the <code class=\"language-text\">NONE</code> value</li>\n</ol>\n<h2 id=\"embedding-the-json-ld-context\"><a href=\"#embedding-the-json-ld-context\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Embedding the JSON-LD Context</h2>\n<p>By default, the generated <a href=\"https://www.w3.org/TR/json-ld/#the-context\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JSON-LD context</a> (<code class=\"language-text\">@context</code>) is only referenced by\nan IRI. A client that uses JSON-LD must send a second HTTP request to retrieve it:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"@context\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/contexts/Book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/books/62\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My awesome book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/people/59\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can configure API Platform to embed the JSON-LD context in the root document by adding the <code class=\"language-text\">jsonld_embed_context</code>\nattribute to the <code class=\"language-text\">@ApiResource</code> annotation:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(normalizationContext={\"jsonld_embed_context\"=true})\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>The JSON output will now include the embedded context:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"@context\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@vocab\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:8000/apidoc#\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"hydra\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.w3.org/ns/hydra/core#\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://schema.org/name\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://schema.org/author\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/books/62\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My awesome book\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/people/59\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"collection-relation\"><a href=\"#collection-relation\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Collection Relation</h2>\n<p>This is a special case where, in an entity, you have a <code class=\"language-text\">toMany</code> relation. By default, Doctrine will use an <code class=\"language-text\">ArrayCollection</code> to store your values. This is fine when you have a <em>read</em> operation, but when you try to <em>write</em> you can observe an issue where the response is not reflecting the changes correctly. It can lead to client errors even though the update was correct.\nIndeed, after an update on this relation, the collection looks wrong because <code class=\"language-text\">ArrayCollection</code>'s indexes are not sequential. To change this, we recommend to use a getter that returns <code class=\"language-text\">$collectionRelation-&gt;getValues()</code>. Thanks to this, the relation is now a real array which is sequentially indexed.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Doctrine<span class=\"token punctuation\">\\</span>Common<span class=\"token punctuation\">\\</span>Collections<span class=\"token punctuation\">\\</span>ArrayCollection</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Doctrine<span class=\"token punctuation\">\\</span>ORM<span class=\"token punctuation\">\\</span>Mapping</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">ORM</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource\n * @ORM\\Entity\n */</span>\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Brand</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @ORM\\Id\n     * @ORM\\Column(type=\"integer\")\n     * @ORM\\GeneratedValue(strategy=\"AUTO\")\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @ORM\\ManyToMany(targetEntity=\"App\\Entity\\Car\", inversedBy=\"brands\")\n     * @ORM\\JoinTable(\n     *     name=\"CarToBrand\",\n     *     joinColumns={@ORM\\JoinColumn(name=\"brand_id\", referencedColumnName=\"id\", nullable=false)},\n     *     inverseJoinColumns={@ORM\\JoinColumn(name=\"car_id\", referencedColumnName=\"id\", nullable=false)}\n     * )\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$cars</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">cars</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">addCar</span><span class=\"token punctuation\">(</span>DummyCar <span class=\"token variable\">$car</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">cars</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$car</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">removeCar</span><span class=\"token punctuation\">(</span>DummyCar <span class=\"token variable\">$car</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">cars</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">removeElement</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$car</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getCars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">cars</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getValues</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">id</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>For reference please check <a href=\"https://github.com/api-platform/core/pull/1534\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#1534</a>.</p>","editPath":"core/serialization.md","title":"The Serialization Process","previous":{"slug":"/docs/core/filters/","title":"Filters"},"next":{"slug":"/docs/core/validation/","title":"Validation"}}}