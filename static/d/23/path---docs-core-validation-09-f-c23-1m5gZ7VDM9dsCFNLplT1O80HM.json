{"pageContext":{"html":"<h1 id=\"validation\"><a href=\"#validation\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Validation</h1>\n<p>API Platform takes care of validating the data sent to the API by the client (usually user data entered through forms).\nBy default, the framework relies on <a href=\"http://symfony.com/doc/current/validation.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the powerful Symfony Validator Component</a>\nfor this task, but you can replace it by your preferred validation library such as <a href=\"http://php.net/manual/en/intro.filter.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the PHP filter extension</a>\nif you want to.</p>\n<h2 id=\"validating-submitted-data\"><a href=\"#validating-submitted-data\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Validating Submitted Data</h2>\n<p>Validating submitted data is as simple as adding <a href=\"http://symfony.com/doc/current/reference/constraints.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Symfony's built-in constraints</a>\nor <a href=\"http://symfony.com/doc/current/validation/custom_constraint.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">custom constraints</a> directly in classes marked with\nthe <code class=\"language-text\">@ApiResource</code> annotation:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Product.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraints<span class=\"token punctuation\">\\</span>MinimalProperties</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// A custom constraint</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Doctrine<span class=\"token punctuation\">\\</span>ORM<span class=\"token punctuation\">\\</span>Mapping</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">ORM</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraints</span> <span class=\"token keyword\">as</span> Assert<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Symfony's built-in constraints</span>\n\n<span class=\"token comment\">/**\n * A product.\n *\n * @ApiResource\n * @ORM\\Entity\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Product</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @var int The id of this product.\n     *\n     * @ORM\\Id\n     * @ORM\\GeneratedValue\n     * @ORM\\Column(type=\"integer\")\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @var string The name of the product\n     *\n     * @Assert\\NotBlank\n     * @ORM\\Column\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @var string[] Describe the product\n     *\n     * @MinimalProperties\n     * @ORM\\Column(type=\"json\")\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$properties</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Getters and setters...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Here is a custom constraint and the related validator:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Validator/Constraints/MinimalProperties.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraints</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraint</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @Annotation\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MinimalProperties</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Constraint</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'The product must have the minimal properties required (\"description\", \"price\")'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Validator/Constraints/MinimalPropertiesValidator.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraints</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraint</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>ConstraintValidator</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @Annotation\n */</span>\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MinimalPropertiesValidator</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ConstraintValidator</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">,</span> Constraint <span class=\"token variable\">$constraint</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> void\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">array_diff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'description'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'price'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">context</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">buildViolation</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$constraint</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">message</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">addViolation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>If the data submitted by the client is invalid, the HTTP status code will be set to <code class=\"language-text\">400 Bad Request</code> and the response's\nbody will contain the list of violations serialized in a format compliant with the requested one. For instance, a validation\nerror will look like the following if the requested format is JSON-LD (the default):</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"@context\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/contexts/ConstraintViolationList\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ConstraintViolationList\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"hydra:title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"An error occurred\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"hydra:description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"properties: The product must have the minimal properties required (\\\"description\\\", \\\"price\\\")\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"violations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"propertyPath\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"properties\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The product must have the minimal properties required (\\\"description\\\", \\\"price\\\")\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Take a look at the <a href=\"/docs/core/errors/\">Errors Handling guide</a> to learn how API Platform converts PHP exceptions like validation\nerrors to HTTP errors.</p>\n<h2 id=\"using-validation-groups\"><a href=\"#using-validation-groups\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Validation Groups</h2>\n<p>Without specific configuration, the default validation group is always used, but this behavior is customizable: the framework\nis able to leverage Symfony's <a href=\"http://symfony.com/doc/current/book/validation.html#validation-groups\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">validation groups</a>.</p>\n<p>You can configure the groups you want to use when the validation occurs directly through the <code class=\"language-text\">ApiResource</code> annotation:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraints</span> <span class=\"token keyword\">as</span> Assert<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(attributes={\"validation_groups\"={\"a\", \"b\"}})\n * ...\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @Assert\\NotBlank(groups={\"a\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @Assert\\NotNull(groups={\"b\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$author</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>With the previous configuration, the validation groups <code class=\"language-text\">a</code> and <code class=\"language-text\">b</code> will be used when validation is performed.</p>\n<p>Like for <a href=\"/docs/core/serialization/#using-different-serialization-groups-per-operation\">serialization groups</a>,\nyou can specify validation groups globally or on a per-operation basis.</p>\n<p>Of course, you can use XML or YAML configuration format instead of annotations if you prefer.</p>\n<p>You may also pass in a <a href=\"http://symfony.com/doc/current/validation/sequence_provider.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">group sequence</a> in place of\nthe array of group names.</p>\n<h2 id=\"using-validation-groups-on-operations\"><a href=\"#using-validation-groups-on-operations\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Validation Groups on Operations</h2>\n<p>You can have different validation for each <a href=\"/docs/core/operations/\">operation</a> related to your resource.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraints</span> <span class=\"token keyword\">as</span> Assert<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(\n *     collectionOperations={\n *         \"get\",\n *         \"post\"={\"validation_groups\"={\"Default\", \"postValidation\"}}\n *     },\n *     itemOperations={\n *         \"delete\",\n *         \"get\",\n *         \"put\"={\"validation_groups\"={\"Default\", \"putValidation\"}}\n *     }\n * )\n * ...\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @Assert\\Uuid\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @Assert\\NotBlank(groups={\"postValidation\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @Assert\\NotNull\n     * @Assert\\Length(\n     *     min = 2,\n     *     max = 50,\n     *     groups={\"postValidation\"}\n     * )\n     * @Assert\\Length(\n     *     min = 2,\n     *     max = 70,\n     *     groups={\"putValidation\"}\n     * )\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$author</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>With this configuration, there are three validation groups:</p>\n<p><code class=\"language-text\">Default</code> contains the constraints that belong to no other group.</p>\n<p><code class=\"language-text\">postValidation</code> contains the constraints on the name and author (length from 2 to 50) fields only.</p>\n<p><code class=\"language-text\">putValidation</code> contains the constraints on the author (length from 2 to 70) field only.</p>\n<h2 id=\"dynamic-validation-groups\"><a href=\"#dynamic-validation-groups\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynamic Validation Groups</h2>\n<p>If you need to dynamically determine which validation groups to use for an entity in different scenarios, just pass in a\n<a href=\"http://php.net/manual/en/language.types.callable.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">callable</a>. The callback will receive the entity object as its first\nargument, and should return an array of group names or a <a href=\"http://symfony.com/doc/current/validation/sequence_provider.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">group sequence</a>.</p>\n<p>In the following example, we use a static method to return the validation groups:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraints</span> <span class=\"token keyword\">as</span> Assert<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(\n *     attributes={\"validation_groups\"={Book::class, \"validationGroups\"}}\n * )\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Return dynamic validation groups.\n     *\n     * @param self $book Contains the instance of Book to validate.\n     *\n     * @return string[]\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function\">validationGroups</span><span class=\"token punctuation\">(</span>self <span class=\"token variable\">$book</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @Assert\\NotBlank(groups={\"a\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @Assert\\NotNull(groups={\"b\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$author</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Alternatively, you can use a service to retrieve the groups to use:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Validator/AdminGroupsGenerator.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Validator</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity<span class=\"token punctuation\">\\</span>Book</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Security<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Authorization<span class=\"token punctuation\">\\</span>AuthorizationCheckerInterface</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AdminGroupsGenerator</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$authorizationChecker</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span>AuthorizationCheckerInterface <span class=\"token variable\">$authorizationChecker</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">authorizationChecker</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$authorizationChecker</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__invoke</span><span class=\"token punctuation\">(</span>Book <span class=\"token variable\">$book</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">array</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">authorizationChecker</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">isGranted</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'ROLE_ADMIN'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$book</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'b'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>This class selects the groups to apply based on the role of the current user: if the current user has the <code class=\"language-text\">ROLE_ADMIN</code> role, groups <code class=\"language-text\">a</code> and <code class=\"language-text\">b</code> are returned. In other cases, just <code class=\"language-text\">a</code> is returned.</p>\n<p>This class is automatically registered as a service thanks to <a href=\"https://symfony.com/doc/current/service_container/autowiring.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the autowiring feature of the Symfony Dependency Injection Component</a>. Just note that this service must be public.</p>\n<p>Then, configure the entity class to use this service to retrieve validation groups:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// api/src/Entity/Book.php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">ApiPlatform<span class=\"token punctuation\">\\</span>Core<span class=\"token punctuation\">\\</span>Annotation<span class=\"token punctuation\">\\</span>ApiResource</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>AdminGroupsGenerator</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>Validator<span class=\"token punctuation\">\\</span>Constraints</span> <span class=\"token keyword\">as</span> Assert<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @ApiResource(attributes={\"validation_groups\"=AdminGroupsGenerator::class})\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @Assert\\NotBlank(groups={\"a\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @Assert\\NotNull(groups={\"b\"})\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$author</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<h2 id=\"error-levels-and-payload-serialization\"><a href=\"#error-levels-and-payload-serialization\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Error Levels and Payload Serialization</h2>\n<p>As stated in the <a href=\"https://symfony.com/doc/current/validation/severity.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Symfony documentation</a>, you can use the payload field to define error levels.\nYou can retrieve the payload field by setting the <code class=\"language-text\">serialize_payload_fields</code> option to <code class=\"language-text\">true</code> in the API Platform config:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/packages/api_platform.yaml</span>\n\n<span class=\"token key atrule\">api_platform</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">validator</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">serialize_payload_fields</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>Then, the serializer will return all payload values in the error response.</p>\n<p>If you want to serialize only some payload fields, define them in the config like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># api/config/packages/api_platform.yaml</span>\n\n<span class=\"token key atrule\">api_platform</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">validator</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">serialize_payload_fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> severity<span class=\"token punctuation\">,</span> anotherPayloadField <span class=\"token punctuation\">]</span></code></pre></div>\n<p>In this example, only <code class=\"language-text\">severity</code> and <code class=\"language-text\">anotherPayloadField</code> will be serialized.</p>\n<h2 id=\"validation-on-collection-relations\"><a href=\"#validation-on-collection-relations\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Validation on Collection Relations</h2>\n<p>Note: this is related to the <a href=\"/docs/core/serialization/#collection-relation\">collection relation denormalization</a>.\nYou may have an issue when trying to validate a relation representing a collection (<code class=\"language-text\">toMany</code>). After fixing the denormalization by using a getter that returns <code class=\"language-text\">$collectionRelation-&gt;getValues()</code>, you should define your validation on the getter instead of the property.</p>\n<p>For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>getter</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>cars<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>constraint</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Valid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>getter</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Brand</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">cars</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @Assert\\Valid\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getCars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">cars</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getValues</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","editPath":"core/validation.md","title":"Validation","previous":{"slug":"/docs/core/serialization/","title":"The Serialization Process"},"next":{"slug":"/docs/core/security/","title":"Security"}}}